name: CI - Build and Test

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [18.x, 20.x]

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}

      - name: Display Node.js Version
        run: node --version

      - name: Install Dependencies
        run: npm install

      - name: Run Unit Tests
        run: npm test

      - name: Validate HTML Structure
        run: |
          echo "Memvalidasi struktur HTML..."
          if [ ! -f "index.html" ]; then
            echo "Error: index.html tidak ditemukan!"
            exit 1
          fi
          echo "✓ File index.html ditemukan"

      - name: Validate CSS File
        run: |
          echo "Memvalidasi file CSS..."
          if [ ! -f "style.css" ]; then
            echo "Error: style.css tidak ditemukan!"
            exit 1
          fi
          echo "✓ File style.css ditemukan"

      - name: Validate JavaScript File
        run: |
          echo "Memvalidasi file JavaScript..."
          if [ ! -f "script.js" ]; then
            echo "Error: script.js tidak ditemukan!"
            exit 1
          fi
          echo "✓ File script.js ditemukan"

      - name: Check Code Syntax
        run: |
          echo "Memeriksa syntax JavaScript..."
          node -c script.js
          echo "✓ Syntax JavaScript valid"

      - name: Build Summary Report
        run: |
          echo "==================================="
          echo "Build Summary Report"
          echo "==================================="
          echo "Status: SUCCESS ✓"
          echo "Node Version: $(node --version)"
          echo "Tanggal: $(date)"
          echo "==================================="

      - name: Upload Test Results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results-node-${{ matrix.node-version }}
          path: |
            index.html
            style.css
            script.js
            test.js

  deployment-check:
    runs-on: ubuntu-latest
    needs: build-and-test

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Deployment Readiness Check
        run: |
          echo "==================================="
          echo "Deployment Readiness Check"
          echo "==================================="
          echo "✓ Build berhasil"
          echo "✓ Test berhasil"
          echo "✓ Siap untuk deployment"
          echo "==================================="
